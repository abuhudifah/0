<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>واصل كاش - أرسل واستلم أموالك بسهولة</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f2b4b',
                        secondary: '#1a3a5f',
                        accent: '#2c7da0',
                        light: '#2a5f7a',
                        teal: '#00b4d8',
                        gold: '#ffb703'
                    },
                    fontFamily: {
                        tajawal: ['Tajawal', 'sans-serif']
                    },
                    screens: {
                        'xs': '480px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                        '2xl': '1536px',
                    }
                }
            }
        }
    </script>
  <style>
        * {
            font-family: 'Tajawal', sans-serif;
        }
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .app-wrapper {
            min-height: 100%;
            width: 100%;
            overflow-x: hidden;
        }
        .gradient-bg {
            background: linear-gradient(145deg, #0a1a2f 0%, #132b44 70%, #1d3e5c 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        #navbar {
            background: rgba(10, 38, 71, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 180, 216, 0.3);
            transition: all 0.3s;
        }
        #navbar.scrolled {
            background: rgba(10, 38, 71, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 30px rgba(0, 180, 216, 0.25);
        }
        .counter-animation {
            animation: countUp 2s ease-out forwards;
        }
        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
        .float-animation {
            animation: float 4s ease-in-out infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 180, 216, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 180, 216, 0.6); }
        }
        .pulse-glow {
            animation: pulse-glow 3s ease-in-out infinite;
        }
        .sidebar-link {
            transition: all 0.3s ease;
        }
        .sidebar-link:hover, .sidebar-link.active {
            background: rgba(0, 180, 216, 0.2);
            border-right: 4px solid #00b4d8;
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a1a2f;
        }
        ::-webkit-scrollbar-thumb {
            background: #00b4d8;
            border-radius: 4px;
        }
        .service-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, #00b4d8, #1d3e5c);
            color: white;
            font-size: 24px;
            margin: 0 auto 16px;
            box-shadow: 0 6px 12px rgba(0,180,216,0.3);
        }
        .testimonial-card {
            background: linear-gradient(145deg, #ffffff 0%, #f1f9ff 100%);
        }
        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
        }
        .admin-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .admin-input:focus {
            outline: none;
            border-color: #00b4d8;
            box-shadow: 0 0 0 3px rgba(0, 180, 216, 0.2);
        }
        .admin-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .admin-btn-primary {
            background: linear-gradient(135deg, #00b4d8, #0096c7);
            color: white;
        }
        .admin-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 180, 216, 0.4);
        }
        .admin-btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .admin-btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        .admin-btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 16px 32px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .toast-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .social-link[href="#"] {
            opacity: 0.5;
            pointer-events: none;
        }
        @media (max-width: 640px) {
            h1 { font-size: 2rem !important; }
            h2 { font-size: 1.75rem !important; }
            .hero-buttons { flex-direction: column; align-items: center; }
            .service-icon { width: 50px; height: 50px; font-size: 20px; }
            .step-circle { width: 40px; height: 40px; font-size: 16px; }
        }
        img, video, iframe { max-width: 100%; height: auto; }
        .container-custom {
            width: 100%;
            padding-left: 1rem;
            padding-right: 1rem;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 640px) {
            .container-custom { max-width: 640px; }
        }
        @media (min-width: 768px) {
            .container-custom { max-width: 768px; }
        }
        @media (min-width: 1024px) {
            .container-custom { max-width: 1024px; }
        }
        @media (min-width: 1280px) {
            .container-custom { max-width: 1280px; }
        }

        /* تحسينات العرض للأجهزة الصغيرة جداً */
        @media (max-width: 480px) {
            .container-custom {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            h1 {
                font-size: 1.75rem !important;
            }
            h2 {
                font-size: 1.5rem !important;
            }
            .service-icon {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            .step-circle {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
        }

        /* تحسينات لوحة الإدارة للشاشات المتوسطة والصغيرة */
        @media (max-width: 1023px) {
            .admin-sidebar {
                position: fixed;
                right: 0;
                top: 0;
                bottom: 0;
                z-index: 60;
                transform: translateX(100%);
                transition: transform 0.3s ease-in-out;
                width: 260px;
            }
            .admin-sidebar.open {
                transform: translateX(0);
            }
            .admin-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                z-index: 55;
            }
            .admin-overlay.open {
                display: block;
            }
        }
        @media (max-width: 768px) {
            .admin-main {
                padding: 1rem;
            }
            .admin-section .grid {
                grid-template-columns: 1fr !important;
            }
            .admin-input, .admin-btn {
                font-size: 14px;
                padding: 10px 14px;
            }
            .admin-sidebar {
                width: 240px;
            }
        }
        @media (max-width: 480px) {
            .admin-main {
                padding: 0.75rem;
            }
            .admin-section .bg-white {
                padding: 1rem;
            }
            .admin-sidebar {
                width: 220px;
            }
        }
        /* إضافة تمرير أفقي للجداول في لوحة الإدارة */
        .admin-table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        /* تحسين أزرار اللمس */
        button, a {
            touch-action: manipulation;
        }
        /* أنماط إضافية للأخبار */
        .news-card {
            transition: all 0.3s ease;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        .news-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 30px -10px rgba(0,180,216,0.3);
        }
        .news-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            background-color: #e5e7eb;
        }
        /* أنماط الفيديوهات التعليمية */
        .video-card {
            transition: all 0.3s ease;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        .video-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 30px -10px rgba(0,180,216,0.3);
        }
        .video-thumbnail {
            position: relative;
            padding-top: 56.25%; /* نسبة 16:9 */
            background-size: cover;
            background-position: center;
            background-color: #e5e7eb;
        }
        .video-play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(0, 180, 216, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        .video-card:hover .video-play-button {
            background: #00b4d8;
            transform: translate(-50%, -50%) scale(1.1);
        }
    </style>
 </head>
 <body class="bg-gray-50">
  <div class="app-wrapper" id="app">
   <!-- Toast Notification -->
   <div id="toast" class="toast"></div>
   <!-- Navigation -->
   <nav id="navbar" class="fixed top-0 left-0 right-0 z-50">
    <div class="container-custom px-4 sm:px-6 lg:px-8">
     <div class="flex items-center justify-between h-20">
      <div class="flex items-center gap-2 sm:gap-4">
       <img src="https://i.ibb.co/qYFCzPPc/0000.png" alt="واصل كاش" class="h-10 w-10 sm:h-14 sm:w-14 object-contain logo" loading="lazy" onerror="this.style.background='linear-gradient(135deg, #00b4d8, #0a2647)'; this.alt='Logo';">
       <span class="text-xl sm:text-2xl font-bold text-white drop-shadow-lg" id="nav-title">واصل كاش</span>
      </div>
      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center gap-4 lg:gap-8">
       <a href="#home" class="text-white hover:text-teal transition-colors font-medium text-sm lg:text-base">الرئيسية</a>
       <a href="#services" class="text-white hover:text-teal transition-colors font-medium text-sm lg:text-base">الخدمات</a>
       <a href="#news" class="text-white hover:text-teal transition-colors font-medium text-sm lg:text-base">آخر الأخبار</a>
       <a href="#videos" class="text-white hover:text-teal transition-colors font-medium text-sm lg:text-base">فيديوهات تعليمية</a>
       <a href="#testimonials" class="text-white hover:text-teal transition-colors font-medium text-sm lg:text-base">آراء العملاء</a>
       <a href="#download" class="text-white hover:text-teal transition-colors font-medium text-sm lg:text-base">تحميل</a>
       <button onclick="showLogin()" class="glass-effect text-white px-4 py-2 rounded-full hover:bg-white hover:text-primary transition-all text-sm lg:text-base">
        <i class="fas fa-lock ml-2"></i>دخول الإدارة
       </button>
      </div>
      <!-- Mobile Menu Button -->
      <button id="mobile-menu-btn" class="md:hidden text-white text-2xl" onclick="toggleMobileMenu()">
       <i class="fas fa-bars"></i>
      </button>
     </div>
    </div>
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden bg-primary/95 backdrop-blur-lg">
     <div class="container-custom px-4 py-4 space-y-3">
      <a href="#home" class="block text-white py-2 hover:text-teal" onclick="toggleMobileMenu()">الرئيسية</a>
      <a href="#services" class="block text-white py-2 hover:text-teal" onclick="toggleMobileMenu()">الخدمات</a>
      <a href="#news" class="block text-white py-2 hover:text-teal" onclick="toggleMobileMenu()">آخر الأخبار</a>
      <a href="#videos" class="block text-white py-2 hover:text-teal" onclick="toggleMobileMenu()">فيديوهات تعليمية</a>
      <a href="#testimonials" class="block text-white py-2 hover:text-teal" onclick="toggleMobileMenu()">آراء العملاء</a>
      <a href="#download" class="block text-white py-2 hover:text-teal" onclick="toggleMobileMenu()">تحميل</a>
      <button onclick="showLogin(); toggleMobileMenu();" class="w-full glass-effect text-white px-6 py-3 rounded-full mt-4">
       <i class="fas fa-lock ml-2"></i>دخول الإدارة
      </button>
     </div>
    </div>
   </nav>
   <!-- Main Content Container -->
   <div id="main-content">
    <!-- Hero Section -->
    <section id="home" class="gradient-bg min-h-screen flex items-center relative overflow-hidden pt-20">
     <div class="absolute inset-0 opacity-10">
      <div class="absolute top-20 right-20 w-72 h-72 bg-teal rounded-full blur-3xl"></div>
      <div class="absolute bottom-20 left-20 w-96 h-96 bg-gold rounded-full blur-3xl"></div>
     </div>
     <div class="container-custom px-4 sm:px-6 lg:px-8 py-16 sm:py-24 md:py-32 relative z-10">
      <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">
       <div class="text-center lg:text-right">
        <h1 id="hero-title" class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4 sm:mb-6 leading-tight">أرسل واستلم أموالك<br><span class="text-teal">بسهولة وأمان</span></h1>
        <p id="hero-subtitle" class="text-base sm:text-lg md:text-xl text-gray-300 mb-6 sm:mb-8 leading-relaxed max-w-2xl mx-auto lg:mx-0">تطبيق واصل كاش يوفر لك أسرع وأسهل طريقة لتحويل الأموال، سداد الفواتير، وشراء العملات الرقمية في اليمن</p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
         <a id="android-link" href="#" target="_blank" rel="noopener noreferrer" class="bg-black text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl flex items-center gap-3 hover:bg-gray-800 transition-all card-hover justify-center">
          <i class="fab fa-google-play text-xl sm:text-2xl text-teal"></i>
          <div class="text-right">
           <div class="text-xs opacity-75">متوفر على</div>
           <div class="font-bold text-sm sm:text-base">Google Play</div>
          </div>
         </a>
         <a id="ios-link" href="#" target="_blank" rel="noopener noreferrer" class="bg-black text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl flex items-center gap-3 hover:bg-gray-800 transition-all card-hover justify-center">
          <i class="fab fa-apple text-xl sm:text-2xl"></i>
          <div class="text-right">
           <div class="text-xs opacity-75">حمّل من</div>
           <div class="font-bold text-sm sm:text-base">App Store</div>
          </div>
         </a>
        </div>
       </div>
       <div class="relative flex justify-center mt-8 lg:mt-0">
        <div class="relative float-animation max-w-xs sm:max-w-sm md:max-w-md">
         <div class="absolute inset-0 bg-teal rounded-3xl blur-2xl opacity-30"></div>
         <div class="relative bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-4 shadow-2xl">
          <div class="bg-primary rounded-2xl p-4 sm:p-6 w-full aspect-[3/5] max-w-[250px] sm:max-w-[280px] md:max-w-[320px] mx-auto flex flex-col items-center justify-center">
           <img src="https://i.ibb.co/qYFCzPPc/0000.png" alt="واصل كاش" class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 mb-4" loading="lazy" onerror="this.style.background='linear-gradient(135deg, #00bcd4, #0a2647)'; this.alt='App';">
           <h3 class="text-white text-lg sm:text-xl font-bold mb-2">واصل كاش</h3>
           <p class="text-gray-400 text-xs sm:text-sm text-center">تحويلات مالية آمنة وسريعة</p>
           <div class="mt-6 sm:mt-8 space-y-2 sm:space-y-3 w-full">
            <div class="glass-effect rounded-lg p-2 sm:p-3 flex items-center gap-2 sm:gap-3"><i class="fas fa-paper-plane text-teal text-sm sm:text-base"></i> <span class="text-white text-xs sm:text-sm">إرسال حوالة</span></div>
            <div class="glass-effect rounded-lg p-2 sm:p-3 flex items-center gap-2 sm:gap-3"><i class="fas fa-hand-holding-usd text-gold text-sm sm:text-base"></i> <span class="text-white text-xs sm:text-sm">استلام حوالة</span></div>
            <div class="glass-effect rounded-lg p-2 sm:p-3 flex items-center gap-2 sm:gap-3"><i class="fas fa-mobile-alt text-green-400 text-sm sm:text-base"></i> <span class="text-white text-xs sm:text-sm">سداد الهاتف</span></div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- Scroll Indicator -->
     <div class="absolute bottom-4 sm:bottom-8 left-1/2 transform -translate-x-1/2">
      <a href="#services" class="text-white opacity-50 hover:opacity-100 transition-opacity">
       <i class="fas fa-chevron-down text-xl sm:text-2xl animate-bounce"></i>
      </a>
     </div>
    </section>
    <!-- Services Section -->
    <section id="services" class="py-16 sm:py-20 md:py-24 bg-gray-50">
     <div class="container-custom px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-10 sm:mb-16">
       <h2 class="text-3xl sm:text-4xl font-bold text-primary mb-3 sm:mb-4">خدماتنا</h2>
       <p class="text-lg sm:text-xl text-gray-600">نقدم لك مجموعة متكاملة من الخدمات المالية</p>
      </div>
      <div id="services-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
       <!-- Services will be loaded dynamically -->
      </div>
     </div>
    </section>
    <!-- Statistics Section -->
    <section id="statistics" class="py-16 sm:py-20 md:py-24 gradient-bg relative overflow-hidden">
     <div class="absolute inset-0 opacity-10">
      <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.1\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30v0h-2v4h-4v2h4v4h2v6h4v4h-4zm6 34v-4h4v4h0v2h4v4h2v-4h4v-2h6zm6 4v0h4v4h0v2h4v4h2v6h4v4h6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')]"></div>
     </div>
     <div class="container-custom px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="text-center mb-10 sm:mb-16">
       <h2 class="text-3xl sm:text-4xl font-bold text-white mb-3 sm:mb-4">إنجازاتنا بالأرقام</h2>
       <p class="text-lg sm:text-xl text-gray-300">نفخر بثقة عملائنا</p>
      </div>
      <div id="stats-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
       <div class="glass-effect rounded-2xl p-6 sm:p-8 text-center">
        <div class="text-3xl sm:text-4xl md:text-5xl font-bold text-teal mb-2 counter-animation" id="stat-users">0</div>
        <div class="text-white text-base sm:text-lg" id="stat-users-label">مستخدم نشط</div>
       </div>
       <div class="glass-effect rounded-2xl p-6 sm:p-8 text-center">
        <div class="text-3xl sm:text-4xl md:text-5xl font-bold text-gold mb-2 counter-animation" id="stat-transfers">0</div>
        <div class="text-white text-base sm:text-lg" id="stat-transfers-label">حوالة منفذة</div>
       </div>
       <div class="glass-effect rounded-2xl p-6 sm:p-8 text-center">
        <div class="text-3xl sm:text-4xl md:text-5xl font-bold text-green-400 mb-2 counter-animation" id="stat-payments">0</div>
        <div class="text-white text-base sm:text-lg" id="stat-payments-label">عملية سداد</div>
       </div>
       <div class="glass-effect rounded-2xl p-6 sm:p-8 text-center">
        <div class="text-3xl sm:text-4xl md:text-5xl font-bold text-purple-400 mb-2 counter-animation" id="stat-agents">0</div>
        <div class="text-white text-base sm:text-lg" id="stat-agents-label">وكيل معتمد</div>
       </div>
      </div>
     </div>
    </section>
    <!-- News Section -->
    <section id="news" class="py-16 sm:py-20 md:py-24 bg-white">
     <div class="container-custom px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-10 sm:mb-16">
       <h2 class="text-3xl sm:text-4xl font-bold text-primary mb-3 sm:mb-4">آخر الأخبار</h2>
       <p class="text-lg sm:text-xl text-gray-600">تابع آخر تحديثاتنا وعروضنا الحصرية</p>
      </div>
      <div id="news-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
       <!-- News will be loaded dynamically -->
      </div>
      <!-- زر عرض المزيد للأخبار -->
      <div id="news-more-container" class="text-center mt-8 sm:mt-10 hidden">
       <button onclick="loadMoreNews()" class="admin-btn bg-gray-100 text-primary hover:bg-gray-200 text-base px-8 py-3 rounded-full">
        <i class="fas fa-arrow-down ml-2"></i>عرض المزيد من الأخبار
       </button>
      </div>
     </div>
    </section>
    <!-- Videos Section (جديد) -->
    <section id="videos" class="py-16 sm:py-20 md:py-24 bg-gray-50">
     <div class="container-custom px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-10 sm:mb-16">
       <h2 class="text-3xl sm:text-4xl font-bold text-primary mb-3 sm:mb-4">فيديوهات تعليمية</h2>
       <p class="text-lg sm:text-xl text-gray-600">شاهد شرح استخدام التطبيق والخدمات</p>
      </div>
      <div id="videos-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
       <!-- Videos will be loaded dynamically -->
      </div>
     </div>
    </section>
    <!-- Testimonials Section -->
    <section id="testimonials" class="py-16 sm:py-20 md:py-24 bg-white">
     <div class="container-custom px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-10 sm:mb-16">
       <h2 class="text-3xl sm:text-4xl font-bold text-primary mb-3 sm:mb-4">آراء عملائنا</h2>
       <p class="text-lg sm:text-xl text-gray-600">ماذا يقول مستخدمونا عن تجربتهم</p>
      </div>
      <div id="testimonials-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
       <!-- Testimonials will be loaded dynamically -->
      </div>
     </div>
    </section>
    <!-- Download Section -->
    <section id="download" class="py-16 sm:py-20 md:py-24 gradient-bg relative overflow-hidden">
     <div class="absolute inset-0">
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[600px] sm:w-[800px] h-[600px] sm:h-[800px] bg-teal rounded-full blur-3xl opacity-10"></div>
     </div>
     <div class="container-custom px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="text-center">
       <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-4 sm:mb-6">حمّل التطبيق الآن</h2>
       <p class="text-lg sm:text-xl text-gray-300 mb-8 sm:mb-12 max-w-2xl mx-auto">انضم لآلاف المستخدمين واستمتع بتجربة مالية سهلة وآمنة</p>
       <div class="flex flex-col sm:flex-row gap-4 sm:gap-6 justify-center">
        <a id="android-link-2" href="#" target="_blank" rel="noopener noreferrer" class="bg-black text-white px-6 sm:px-10 py-4 sm:py-5 rounded-xl sm:rounded-2xl flex items-center gap-3 sm:gap-4 hover:bg-gray-800 transition-all card-hover pulse-glow justify-center">
         <i class="fab fa-google-play text-2xl sm:text-4xl text-teal"></i>
         <div class="text-right">
          <div class="text-xs sm:text-sm opacity-75">متوفر على</div>
          <div class="text-base sm:text-xl font-bold">Google Play</div>
         </div>
        </a>
        <a id="ios-link-2" href="#" target="_blank" rel="noopener noreferrer" class="bg-black text-white px-6 sm:px-10 py-4 sm:py-5 rounded-xl sm:rounded-2xl flex items-center gap-3 sm:gap-4 hover:bg-gray-800 transition-all card-hover pulse-glow justify-center">
         <i class="fab fa-apple text-2xl sm:text-4xl"></i>
         <div class="text-right">
          <div class="text-xs sm:text-sm opacity-75">حمّل من</div>
          <div class="text-base sm:text-xl font-bold">App Store</div>
         </div>
        </a>
       </div>
      </div>
     </div>
    </section>
    <!-- Social Media Section -->
    <section id="social" class="py-12 sm:py-16 bg-white">
     <div class="container-custom px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-6 sm:mb-8">
       <h2 class="text-xl sm:text-2xl font-bold text-primary mb-2">تابعنا على وسائل التواصل</h2>
       <p class="text-sm sm:text-base text-gray-600">ابقَ على اطلاع بآخر أخبارنا وعروضنا</p>
      </div>
      <div id="social-links" class="flex flex-wrap justify-center gap-3 sm:gap-6"></div>
     </div>
    </section>
    <!-- Footer -->
    <footer class="bg-primary py-8 sm:py-12">
     <div class="container-custom px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 sm:gap-8 mb-6 sm:mb-8">
       <div>
        <div class="flex items-center gap-3 mb-4">
         <img src="https://i.ibb.co/qYFCzPPc/0000.png" alt="واصل كاش" class="h-8 w-8 sm:h-10 sm:w-10 object-contain" loading="lazy" onerror="this.style.background='linear-gradient(135deg, #00bcd4, #0a2647)';">
         <span class="text-lg sm:text-xl font-bold text-white">واصل كاش</span>
        </div>
        <p class="text-gray-400 text-sm sm:text-base">تطبيق التحويلات المالية الرائد في اليمن</p>
       </div>
       <div>
        <h4 class="text-white font-bold mb-4 text-base sm:text-lg">روابط سريعة</h4>
        <ul class="space-y-2">
         <li><a href="#services" class="text-gray-400 hover:text-teal transition-colors text-sm sm:text-base">الخدمات</a></li>
         <li><a href="#news" class="text-gray-400 hover:text-teal transition-colors text-sm sm:text-base">آخر الأخبار</a></li>
         <li><a href="#videos" class="text-gray-400 hover:text-teal transition-colors text-sm sm:text-base">فيديوهات تعليمية</a></li>
         <li><a href="#download" class="text-gray-400 hover:text-teal transition-colors text-sm sm:text-base">تحميل التطبيق</a></li>
        </ul>
       </div>
       <div>
        <h4 class="text-white font-bold mb-4 text-base sm:text-lg">تواصل معنا</h4>
        <ul class="space-y-2 text-gray-400 text-sm sm:text-base">
         <li class="flex items-center gap-2"><i class="fas fa-envelope text-teal ml-2"></i><span id="footer-email">info@waselcash.com</span></li>
         <li class="flex items-center gap-2"><i class="fas fa-phone text-teal ml-2"></i><span id="footer-phone">+967 XXX XXX XXX</span></li>
         <li class="flex items-center gap-2"><i class="fas fa-map-marker-alt text-teal ml-2"></i><span id="footer-address">، اليمن</span></li>
        </ul>
       </div>
      </div>
      <div class="border-t border-gray-700 pt-6 sm:pt-8 text-center">
       <p class="text-gray-400 text-sm sm:text-base">© 2024 Malek Art. جميع الحقوق محفوظة.</p>
      </div>
     </div>
    </footer>
   </div>
   <!-- Login Modal -->
   <div id="login-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideLogin()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-md">
     <div class="bg-white rounded-2xl p-6 sm:p-8 shadow-2xl mx-4">
      <div class="text-center mb-6 sm:mb-8">
       <img src="https://i.ibb.co/qYFCzPPc/0000.png" alt="واصل كاش" class="h-12 w-12 sm:h-16 sm:w-16 mx-auto mb-4" loading="lazy" onerror="this.style.background='linear-gradient(135deg, #00bcd4, #0a2647)';">
       <h2 class="text-xl sm:text-2xl font-bold text-primary">تسجيل دخول الإدارة</h2>
       <p class="text-gray-500 mt-2 text-sm sm:text-base">أدخل بيانات حسابك للوصول إلى لوحة التحكم</p>
      </div>
      <form id="login-form" onsubmit="handleLogin(event)">
       <div class="mb-4">
        <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base" for="login-email">البريد الإلكتروني</label>
        <input type="email" id="login-email" class="admin-input text-sm sm:text-base" placeholder="admin@waselcash.com" required>
       </div>
       <div class="mb-6">
        <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base" for="login-password">كلمة المرور</label>
        <input type="password" id="login-password" class="admin-input text-sm sm:text-base" placeholder="••••••••" required>
       </div>
       <button type="submit" id="login-btn" class="admin-btn admin-btn-primary w-full text-sm sm:text-base">
        <i class="fas fa-sign-in-alt ml-2"></i>تسجيل الدخول
       </button>
      </form>
      <div id="login-error" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600 text-center text-sm"></div>
      <button onclick="hideLogin()" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600">
       <i class="fas fa-times text-xl"></i>
      </button>
     </div>
    </div>
   </div>
   <!-- Admin Dashboard -->
   <div id="admin-dashboard" class="hidden">
    <!-- Overlay for mobile sidebar -->
    <div id="admin-overlay" class="admin-overlay" onclick="toggleAdminSidebar()"></div>
    <div class="flex h-screen bg-gray-100 overflow-hidden">
     <!-- Sidebar -->
     <aside id="admin-sidebar" class="admin-sidebar w-64 bg-primary text-white flex-shrink-0 overflow-y-auto transition-transform duration-300">
      <div class="p-4 sm:p-6">
       <div class="flex items-center justify-between gap-3 mb-8">
        <div class="flex items-center gap-3">
         <img src="https://i.ibb.co/qYFCzPPc/0000.png" alt="واصل كاش" class="h-8 w-8 sm:h-10 sm:w-10 object-contain" loading="lazy" onerror="this.style.background='linear-gradient(135deg, #00bcd4, #0a2647)';">
         <span class="text-base sm:text-lg font-bold">لوحة التحكم</span>
        </div>
        <button class="lg:hidden text-white text-xl" onclick="toggleAdminSidebar()">
         <i class="fas fa-times"></i>
        </button>
       </div>
       <nav class="space-y-2">
        <button onclick="showAdminSection('dashboard'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link active w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="dashboard">
         <i class="fas fa-home w-5"></i> <span>الرئيسية</span>
        </button>
        <button onclick="showAdminSection('content'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="content">
         <i class="fas fa-edit w-5"></i> <span>المحتوى العام</span>
        </button>
        <button onclick="showAdminSection('services'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="services">
         <i class="fas fa-concierge-bell w-5"></i> <span>الخدمات</span>
        </button>
        <button onclick="showAdminSection('statistics'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="statistics">
         <i class="fas fa-chart-bar w-5"></i> <span>الإحصائيات</span>
        </button>
        <button onclick="showAdminSection('news'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="news">
         <i class="fas fa-newspaper w-5"></i> <span>آخر الأخبار</span>
        </button>
        <button onclick="showAdminSection('videos'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="videos">
         <i class="fas fa-video w-5"></i> <span>فيديوهات تعليمية</span>
        </button>
        <button onclick="showAdminSection('testimonials'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="testimonials">
         <i class="fas fa-comments w-5"></i> <span>آراء العملاء</span>
        </button>
        <button onclick="showAdminSection('downloads'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="downloads">
         <i class="fas fa-download w-5"></i> <span>روابط التحميل</span>
        </button>
        <button onclick="showAdminSection('social'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="social">
         <i class="fas fa-share-alt w-5"></i> <span>وسائل التواصل</span>
        </button>
        <button onclick="showAdminSection('admins'); if(window.innerWidth < 1024) toggleAdminSidebar();" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 rounded-lg text-right" data-section="admins">
         <i class="fas fa-users-cog w-5"></i> <span>إدارة المسؤولين</span>
        </button>
       </nav>
      </div>
      <div class="p-4 sm:p-6 border-t border-gray-700">
       <button onclick="handleLogout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-400 hover:bg-red-500/20 transition-colors">
        <i class="fas fa-sign-out-alt w-5"></i> <span>تسجيل الخروج</span>
       </button>
      </div>
     </aside>
     <!-- Main Content -->
     <main class="flex-1 overflow-y-auto admin-main">
      <!-- Header -->
      <header class="bg-white shadow-sm px-4 sm:px-8 py-4 flex items-center justify-between">
       <div class="flex items-center gap-3">
        <button class="lg:hidden text-primary text-xl" onclick="toggleAdminSidebar()">
         <i class="fas fa-bars"></i>
        </button>
        <h1 id="admin-page-title" class="text-lg sm:text-xl font-bold text-primary">لوحة التحكم</h1>
       </div>
       <div class="flex items-center gap-4">
        <button onclick="previewSite()" class="admin-btn bg-gray-100 text-gray-700 hover:bg-gray-200 text-sm sm:text-base px-3 sm:px-4 py-2">
         <i class="fas fa-eye ml-2"></i><span class="hidden sm:inline">معاينة الموقع</span>
        </button>
        <div class="flex items-center gap-2">
         <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-teal to-primary flex items-center justify-center text-white">
          <i class="fas fa-user text-sm sm:text-base"></i>
         </div>
         <span id="admin-user-email" class="text-gray-600 text-xs sm:text-sm hidden sm:inline">admin@waselcash.com</span>
        </div>
       </div>
      </header>
      <!-- Content Area -->
      <div class="p-4 sm:p-8">
       <!-- Dashboard Section -->
       <section id="section-dashboard" class="admin-section">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
         <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
           <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-teal/20 flex items-center justify-center"><i class="fas fa-concierge-bell text-teal text-lg sm:text-xl"></i></div>
           <span class="text-2xl sm:text-3xl font-bold text-primary" id="admin-services-count">0</span>
          </div>
          <h3 class="text-gray-600 text-sm sm:text-base">الخدمات</h3>
         </div>
         <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
           <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gold/20 flex items-center justify-center"><i class="fas fa-comments text-gold text-lg sm:text-xl"></i></div>
           <span class="text-2xl sm:text-3xl font-bold text-primary" id="admin-testimonials-count">0</span>
          </div>
          <h3 class="text-gray-600 text-sm sm:text-base">آراء العملاء</h3>
         </div>
         <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
           <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-green-500/20 flex items-center justify-center"><i class="fas fa-newspaper text-green-500 text-lg sm:text-xl"></i></div>
           <span class="text-2xl sm:text-3xl font-bold text-primary" id="admin-news-count">0</span>
          </div>
          <h3 class="text-gray-600 text-sm sm:text-base">الأخبار</h3>
         </div>
         <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
           <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-purple-500/20 flex items-center justify-center"><i class="fas fa-video text-purple-500 text-lg sm:text-xl"></i></div>
           <span class="text-2xl sm:text-3xl font-bold text-primary" id="admin-videos-count">0</span>
          </div>
          <h3 class="text-gray-600 text-sm sm:text-base">الفيديوهات</h3>
         </div>
        </div>
        <!-- إحصائيات الزوار -->
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
         <h3 class="text-base sm:text-lg font-bold text-primary mb-4">إحصائيات الزوار</h3>
         <div class="flex items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-teal/20 flex items-center justify-center"><i class="fas fa-eye text-teal text-2xl"></i></div>
          <div>
           <span class="text-3xl font-bold text-primary" id="admin-visitors-count">0</span>
           <p class="text-gray-600">إجمالي زوار الموقع</p>
          </div>
          <button onclick="resetVisitorCount()" class="admin-btn bg-gray-100 text-gray-700 hover:bg-gray-200 text-sm px-4 py-2 mr-auto">
           <i class="fas fa-sync-alt ml-2"></i>إعادة تعيين
          </button>
         </div>
        </div>
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
         <h3 class="text-base sm:text-lg font-bold text-primary mb-4">مرحباً بك في لوحة التحكم</h3>
         <p class="text-gray-600 text-sm sm:text-base mb-4">من هنا يمكنك إدارة محتوى موقع واصل كاش بالكامل. استخدم القائمة الجانبية للتنقل بين الأقسام المختلفة.</p>
         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="bg-gray-50 rounded-lg p-4">
           <h4 class="font-bold text-primary mb-2 text-sm sm:text-base"><i class="fas fa-lightbulb text-gold ml-2"></i>نصيحة</h4>
           <p class="text-gray-600 text-xs sm:text-sm">قم بتحديث المحتوى بشكل دوري للحفاظ على تفاعل الزوار مع موقعك.</p>
          </div>
          <div class="bg-gray-50 rounded-lg p-4">
           <h4 class="font-bold text-primary mb-2 text-sm sm:text-base"><i class="fas fa-info-circle text-teal ml-2"></i>ملاحظة</h4>
           <p class="text-gray-600 text-xs sm:text-sm">جميع التغييرات تُحفظ في Firebase Realtime Database ويتم تحديث الموقع تلقائياً.</p>
          </div>
         </div>
        </div>
       </section>
       <!-- Content Section -->
       <section id="section-content" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
         <h3 class="text-base sm:text-lg font-bold text-primary mb-6">تعديل المحتوى العام</h3>
         <form id="content-form" onsubmit="saveContent(event)" class="space-y-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عنوان الموقع</label> <input type="text" id="content-site-title" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">رابط الشعار</label> <input type="url" id="content-logo" class="admin-input text-sm"></div>
          </div>
          <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">العنوان الرئيسي (Hero Title)</label> <input type="text" id="content-hero-title" class="admin-input text-sm"></div>
          <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">الوصف الرئيسي</label> <textarea id="content-hero-subtitle" class="admin-input text-sm" rows="3"></textarea></div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">البريد الإلكتروني</label> <input type="email" id="content-email" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">رقم الهاتف</label> <input type="text" id="content-phone" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">العنوان</label> <input type="text" id="content-address" class="admin-input text-sm"></div>
          </div>
          <button type="submit" class="admin-btn admin-btn-primary text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ التغييرات</button>
         </form>
        </div>
       </section>
       <!-- Services Section -->
       <section id="section-services" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
         <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <h3 class="text-base sm:text-lg font-bold text-primary">إدارة الخدمات</h3>
          <button onclick="showAddServiceModal()" class="admin-btn admin-btn-primary text-sm sm:text-base w-full sm:w-auto"><i class="fas fa-plus ml-2"></i>إضافة خدمة</button>
         </div>
         <div id="admin-services-list" class="space-y-4 admin-table-container"></div>
        </div>
       </section>
       <!-- Statistics Section -->
       <section id="section-statistics" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
         <h3 class="text-base sm:text-lg font-bold text-primary mb-6">تعديل الإحصائيات</h3>
         <form id="stats-form" onsubmit="saveStats(event)" class="space-y-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عدد المستخدمين</label> <input type="text" id="stat-users-input" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">تسمية المستخدمين</label> <input type="text" id="stat-users-label" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عدد الحوالات</label> <input type="text" id="stat-transfers-input" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">تسمية الحوالات</label> <input type="text" id="stat-transfers-label" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عدد عمليات السداد</label> <input type="text" id="stat-payments-input" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">تسمية السداد</label> <input type="text" id="stat-payments-label" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عدد الوكلاء</label> <input type="text" id="stat-agents-input" class="admin-input text-sm"></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">تسمية الوكلاء</label> <input type="text" id="stat-agents-label" class="admin-input text-sm"></div>
          </div>
          <button type="submit" class="admin-btn admin-btn-primary text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ الإحصائيات</button>
         </form>
        </div>
       </section>
       <!-- News Section -->
       <section id="section-news" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
         <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <h3 class="text-base sm:text-lg font-bold text-primary">إدارة الأخبار</h3>
          <button onclick="showAddNewsModal()" class="admin-btn admin-btn-primary text-sm sm:text-base w-full sm:w-auto"><i class="fas fa-plus ml-2"></i>إضافة خبر</button>
         </div>
         <div id="admin-news-list" class="space-y-4 admin-table-container"></div>
        </div>
       </section>
       <!-- Videos Section -->
       <section id="section-videos" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
         <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <h3 class="text-base sm:text-lg font-bold text-primary">إدارة الفيديوهات التعليمية</h3>
          <button onclick="showAddVideoModal()" class="admin-btn admin-btn-primary text-sm sm:text-base w-full sm:w-auto"><i class="fas fa-plus ml-2"></i>إضافة فيديو</button>
         </div>
         <div id="admin-videos-list" class="space-y-4 admin-table-container"></div>
        </div>
       </section>
       <!-- Testimonials Section -->
       <section id="section-testimonials" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
         <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <h3 class="text-base sm:text-lg font-bold text-primary">إدارة آراء العملاء</h3>
          <button onclick="showAddTestimonialModal()" class="admin-btn admin-btn-primary text-sm sm:text-base w-full sm:w-auto"><i class="fas fa-plus ml-2"></i>إضافة رأي</button>
         </div>
         <div id="admin-testimonials-list" class="space-y-4 admin-table-container"></div>
        </div>
       </section>
       <!-- Downloads Section -->
       <section id="section-downloads" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
         <h3 class="text-base sm:text-lg font-bold text-primary mb-6">روابط التحميل</h3>
         <form id="downloads-form" onsubmit="saveDownloads(event)" class="space-y-6">
          <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-google-play text-teal ml-2"></i>رابط Google Play</label> <input type="url" id="download-android" class="admin-input text-sm" placeholder="https://play.google.com/store/apps/details?id=..."></div>
          <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-apple ml-2"></i>رابط App Store</label> <input type="url" id="download-ios" class="admin-input text-sm" placeholder="https://apps.apple.com/app/..."></div>
          <button type="submit" class="admin-btn admin-btn-primary text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ الروابط</button>
         </form>
        </div>
       </section>
       <!-- Social Section -->
       <section id="section-social" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm">
         <h3 class="text-base sm:text-lg font-bold text-primary mb-6">وسائل التواصل الاجتماعي</h3>
         <form id="social-form" onsubmit="saveSocial(event)" class="space-y-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-facebook text-blue-600 ml-2"></i>Facebook</label> <input type="url" id="social-facebook" class="admin-input text-sm" placeholder="https://facebook.com/..."></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-twitter text-sky-400 ml-2"></i>Twitter</label> <input type="url" id="social-twitter" class="admin-input text-sm" placeholder="https://twitter.com/..."></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-instagram text-pink-500 ml-2"></i>Instagram</label> <input type="url" id="social-instagram" class="admin-input text-sm" placeholder="https://instagram.com/..."></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-whatsapp text-green-500 ml-2"></i>WhatsApp</label> <input type="url" id="social-whatsapp" class="admin-input text-sm" placeholder="https://wa.me/..."></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-youtube text-red-500 ml-2"></i>YouTube</label> <input type="url" id="social-youtube" class="admin-input text-sm" placeholder="https://youtube.com/..."></div>
           <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base"><i class="fab fa-telegram text-blue-400 ml-2"></i>Telegram</label> <input type="url" id="social-telegram" class="admin-input text-sm" placeholder="https://t.me/..."></div>
          </div>
          <button type="submit" class="admin-btn admin-btn-primary text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ الروابط</button>
         </form>
        </div>
       </section>
       <!-- Admins Section -->
       <section id="section-admins" class="admin-section hidden">
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-sm mb-6">
         <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <h3 class="text-base sm:text-lg font-bold text-primary">إدارة المسؤولين</h3>
          <button onclick="showAddAdminModal()" class="admin-btn admin-btn-primary text-sm sm:text-base w-full sm:w-auto"><i class="fas fa-plus ml-2"></i>إضافة مسؤول</button>
         </div>
         <div id="admin-admins-list" class="space-y-4 admin-table-container"></div>
        </div>
       </section>
      </div>
     </main>
    </div>
   </div>
   <!-- Add Service Modal -->
   <div id="service-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideServiceModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-lg">
     <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-2xl mx-4 max-h-[90vh] overflow-y-auto">
      <h3 class="text-base sm:text-xl font-bold text-primary mb-6" id="service-modal-title">إضافة خدمة جديدة</h3>
      <form id="service-form" onsubmit="saveService(event)" class="space-y-4">
       <input type="hidden" id="service-id">
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">اسم الخدمة</label> <input type="text" id="service-title" class="admin-input text-sm" required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">وصف الخدمة</label> <textarea id="service-description" class="admin-input text-sm" rows="3" required></textarea></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">أيقونة Font Awesome</label> <input type="text" id="service-icon" class="admin-input text-sm" placeholder="fas fa-exchange-alt" required>
        <p class="text-xs text-gray-500 mt-1">مثال: fas fa-paper-plane, fas fa-mobile-alt</p>
       </div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">ترتيب العرض</label> <input type="number" id="service-order" class="admin-input text-sm" value="1" min="1"></div>
       <div class="flex gap-4 pt-4">
        <button type="submit" class="admin-btn admin-btn-primary flex-1 text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ</button>
        <button type="button" onclick="hideServiceModal()" class="admin-btn bg-gray-200 text-gray-700 flex-1 text-sm sm:text-base">إلغاء</button>
       </div>
      </form>
     </div>
    </div>
   </div>
   <!-- Add News Modal -->
   <div id="news-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideNewsModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-lg">
     <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-2xl mx-4 max-h-[90vh] overflow-y-auto">
      <h3 class="text-base sm:text-xl font-bold text-primary mb-6" id="news-modal-title">إضافة خبر جديد</h3>
      <form id="news-form" onsubmit="saveNews(event)" class="space-y-4">
       <input type="hidden" id="news-id">
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عنوان الخبر</label> <input type="text" id="news-title" class="admin-input text-sm" required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">محتوى الخبر</label> <textarea id="news-content" class="admin-input text-sm" rows="4" required></textarea></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">رابط الصورة</label> <input type="url" id="news-image" class="admin-input text-sm" placeholder="https://..." required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">تاريخ النشر (اختياري)</label> <input type="date" id="news-date" class="admin-input text-sm"></div>
       <div class="flex gap-4 pt-4">
        <button type="submit" class="admin-btn admin-btn-primary flex-1 text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ</button>
        <button type="button" onclick="hideNewsModal()" class="admin-btn bg-gray-200 text-gray-700 flex-1 text-sm sm:text-base">إلغاء</button>
       </div>
      </form>
     </div>
    </div>
   </div>
   <!-- Add Video Modal -->
   <div id="video-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideVideoModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-lg">
     <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-2xl mx-4 max-h-[90vh] overflow-y-auto">
      <h3 class="text-base sm:text-xl font-bold text-primary mb-6" id="video-modal-title">إضافة فيديو جديد</h3>
      <form id="video-form" onsubmit="saveVideo(event)" class="space-y-4">
       <input type="hidden" id="video-id">
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">عنوان الفيديو</label> <input type="text" id="video-title" class="admin-input text-sm" required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">رابط يوتيوب</label> <input type="url" id="video-url" class="admin-input text-sm" placeholder="https://www.youtube.com/watch?v=..." required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">صورة مصغرة (اختياري)</label> <input type="url" id="video-thumbnail" class="admin-input text-sm" placeholder="https://..."></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">ترتيب العرض</label> <input type="number" id="video-order" class="admin-input text-sm" value="1" min="1"></div>
       <div class="flex gap-4 pt-4">
        <button type="submit" class="admin-btn admin-btn-primary flex-1 text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ</button>
        <button type="button" onclick="hideVideoModal()" class="admin-btn bg-gray-200 text-gray-700 flex-1 text-sm sm:text-base">إلغاء</button>
       </div>
      </form>
     </div>
    </div>
   </div>
   <!-- Add Testimonial Modal -->
   <div id="testimonial-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideTestimonialModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-lg">
     <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-2xl mx-4 max-h-[90vh] overflow-y-auto">
      <h3 class="text-base sm:text-xl font-bold text-primary mb-6" id="testimonial-modal-title">إضافة رأي جديد</h3>
      <form id="testimonial-form" onsubmit="saveTestimonial(event)" class="space-y-4">
       <input type="hidden" id="testimonial-id">
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">اسم العميل</label> <input type="text" id="testimonial-name" class="admin-input text-sm" required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">الدور / المهنة</label> <input type="text" id="testimonial-role" class="admin-input text-sm" placeholder="تاجر في صنعاء" required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">نص الرأي</label> <textarea id="testimonial-text" class="admin-input text-sm" rows="4" required></textarea></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">رابط الصورة (اختياري)</label> <input type="url" id="testimonial-image" class="admin-input text-sm" placeholder="https://..."></div>
       <div class="flex gap-4 pt-4">
        <button type="submit" class="admin-btn admin-btn-primary flex-1 text-sm sm:text-base"><i class="fas fa-save ml-2"></i>حفظ</button>
        <button type="button" onclick="hideTestimonialModal()" class="admin-btn bg-gray-200 text-gray-700 flex-1 text-sm sm:text-base">إلغاء</button>
       </div>
      </form>
     </div>
    </div>
   </div>
   <!-- Add Admin Modal -->
   <div id="admin-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideAdminModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-lg">
     <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-2xl mx-4">
      <h3 class="text-base sm:text-xl font-bold text-primary mb-6">إضافة مسؤول جديد</h3>
      <form id="admin-form" onsubmit="saveAdmin(event)" class="space-y-4">
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">البريد الإلكتروني</label> <input type="email" id="admin-email-input" class="admin-input text-sm" required></div>
       <div><label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">كلمة المرور</label> <input type="password" id="admin-password-input" class="admin-input text-sm" required minlength="6"></div>
       <div class="flex gap-4 pt-4">
        <button type="submit" class="admin-btn admin-btn-primary flex-1 text-sm sm:text-base"><i class="fas fa-save ml-2"></i>إضافة</button>
        <button type="button" onclick="hideAdminModal()" class="admin-btn bg-gray-200 text-gray-700 flex-1 text-sm sm:text-base">إلغاء</button>
       </div>
      </form>
     </div>
    </div>
   </div>
   <!-- Delete Confirmation Modal -->
   <div id="delete-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0" onclick="hideDeleteModal()"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-[90%] sm:max-w-md">
     <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-2xl mx-4 text-center">
      <div class="w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4"><i class="fas fa-trash-alt text-red-500 text-xl sm:text-2xl"></i></div>
      <h3 class="text-base sm:text-xl font-bold text-primary mb-2">تأكيد الحذف</h3>
      <p class="text-gray-600 text-sm sm:text-base mb-6" id="delete-message">هل أنت متأكد من حذف هذا العنصر؟</p>
      <div class="flex gap-4">
       <button onclick="confirmDelete()" class="admin-btn admin-btn-danger flex-1 text-sm sm:text-base"><i class="fas fa-trash ml-2"></i>حذف</button>
       <button onclick="hideDeleteModal()" class="admin-btn bg-gray-200 text-gray-700 flex-1 text-sm sm:text-base">إلغاء</button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // ==================== تهيئة Firebase ====================
    const firebaseConfig = {
        apiKey: "AIzaSyCZ9IUXRK-5Kb-TWhQL9nuwse_lmdCzP9g",
        authDomain: "abu-hatheefa-app-68ff1.firebaseapp.com",
        databaseURL: "https://abu-hatheefa-app-68ff1-default-rtdb.firebaseio.com",
        projectId: "abu-hatheefa-app-68ff1",
        storageBucket: "abu-hatheefa-app-68ff1.firebasestorage.app",
        messagingSenderId: "33088080519",
        appId: "1:33088080519:web:11db637971057b67828622"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // ==================== دوال مساعدة ====================
    function escapeHtml(unsafe) {
        if (unsafe === null || unsafe === undefined) return '';
        return String(unsafe)
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type === 'success' ? 'toast-success' : 'toast-error'} show`;
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function handleFirebaseError(error) {
        console.error(error);
        showToast(error.message || 'حدث خطأ في الاتصال بقاعدة البيانات', 'error');
        throw error; // إعادة رمي الخطأ لمنع اعتبار العملية ناجحة
    }

    // ==================== حالة التطبيق ====================
    let appState = {
        isLoggedIn: false,
        currentUser: null,
        currentSection: 'dashboard',
        deleteCallback: null,
        services: [],
        testimonials: [],
        news: [],
        videos: [], // إضافة مصفوفة الفيديوهات
        admins: [],
        visitors: 0,
        settings: {
            siteTitle: 'واصل كاش',
            logo: 'https://i.ibb.co/4RXzChj0/Black-and-White-Initial-P-Corporate-Logo-20260223-224439.png',
            heroTitle: 'أرسل واستلم أموالك بسهولة وأمان',
            heroSubtitle: 'تطبيق واصل كاش يوفر لك أسرع وأسهل طريقة لتحويل الأموال، سداد الفواتير، ',
            email: 'info@waselcash.com',
            phone: '+967 XXX XXX XXX',
            address: 'صنعاء، اليمن',
            androidLink: '',
            iosLink: '',
            social: {
                facebook: '',
                twitter: '',
                instagram: '',
                whatsapp: '',
                youtube: '',
                telegram: ''
            }
        },
        stats: {
            users: '0',
            usersLabel: 'مستخدم نشط',
            transfers: '0',
            transfersLabel: 'حوالة منفذة',
            payments: '0',
            paymentsLabel: 'عملية سداد',
            agents: '0',
            agentsLabel: 'وكيل معتمد'
        },
        newsDisplayCount: 3 // عدد الأخبار المعروضة مبدئياً
    };

    // ==================== مستمعات Firebase (تحديث تلقائي) ====================
    function setupFirebaseListeners() {
        // الإعدادات
        database.ref('settings').on('value', snapshot => {
            if (snapshot.exists()) Object.assign(appState.settings, snapshot.val());
            updatePublicContent();
            if (appState.isLoggedIn) loadContentForm();
        });

        // الإحصائيات
        database.ref('stats').on('value', snapshot => {
            if (snapshot.exists()) Object.assign(appState.stats, snapshot.val());
            updatePublicStats();
            if (appState.isLoggedIn) loadStatsForm();
        });

        // الخدمات
        database.ref('services').on('value', snapshot => {
            if (snapshot.exists()) {
                appState.services = Object.values(snapshot.val());
            } else {
                appState.services = [];
            }
            updatePublicServices();
            if (appState.isLoggedIn) loadServicesList();
            updateDashboardCounts();
        });

        // آراء العملاء
        database.ref('testimonials').on('value', snapshot => {
            if (snapshot.exists()) {
                appState.testimonials = Object.values(snapshot.val());
            } else {
                appState.testimonials = [];
            }
            updatePublicTestimonials();
            if (appState.isLoggedIn) loadTestimonialsList();
            updateDashboardCounts();
        });

        // الأخبار
        database.ref('news').on('value', snapshot => {
            console.log('تم استلام بيانات الأخبار:', snapshot.val());
            if (snapshot.exists()) {
                appState.news = Object.values(snapshot.val());
                // ترتيب تنازلي حسب التاريخ (الأحدث أولاً)
                appState.news.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
            } else {
                appState.news = [];
            }
            updatePublicNews();
            if (appState.isLoggedIn) loadNewsList();
            updateDashboardCounts();
        });

        // الفيديوهات التعليمية
        database.ref('videos').on('value', snapshot => {
            console.log('تم استلام بيانات الفيديوهات:', snapshot.val());
            if (snapshot.exists()) {
                appState.videos = Object.values(snapshot.val());
                // ترتيب حسب الحقل order
                appState.videos.sort((a, b) => (a.order || 999) - (b.order || 999));
            } else {
                appState.videos = [];
            }
            updatePublicVideos();
            if (appState.isLoggedIn) loadVideosList();
            updateDashboardCounts();
        });

        // روابط التحميل
        database.ref('downloads').on('value', snapshot => {
            if (snapshot.exists()) {
                appState.settings.androidLink = snapshot.val().android || '';
                appState.settings.iosLink = snapshot.val().ios || '';
            } else {
                appState.settings.androidLink = '';
                appState.settings.iosLink = '';
            }
            updatePublicDownloads();
            if (appState.isLoggedIn) loadDownloadsForm();
        });

        // وسائل التواصل
        database.ref('social').on('value', snapshot => {
            if (snapshot.exists()) Object.assign(appState.settings.social, snapshot.val());
            updatePublicSocial();
            if (appState.isLoggedIn) loadSocialForm();
        });

        // المسؤولين
        database.ref('admins').on('value', snapshot => {
            if (snapshot.exists()) {
                appState.admins = Object.values(snapshot.val());
            } else {
                appState.admins = [];
            }
            if (appState.isLoggedIn) loadAdminsList();
            updateDashboardCounts();
        });

        // عداد الزوار
        database.ref('visitors').on('value', snapshot => {
            appState.visitors = snapshot.val() || 0;
            document.getElementById('admin-visitors-count').textContent = appState.visitors;
        });
    }

    // دالة لزيادة عدد الزوار (تُستدعى عند تحميل الصفحة)
    function incrementVisitorCount() {
        if (!sessionStorage.getItem('visitor_recorded')) {
            database.ref('visitors').transaction(current => (current || 0) + 1);
            sessionStorage.setItem('visitor_recorded', 'true');
        }
    }

    // دالة إعادة تعيين العداد (للمسؤول)
    function resetVisitorCount() {
        database.ref('visitors').set(0).then(() => {
            showToast('تم إعادة تعيين عداد الزوار');
        }).catch(handleFirebaseError);
    }

    // ==================== دوال الحفظ في Firebase (مع معالجة الأخطاء) ====================
    function saveToFirebase(path, data) {
        return database.ref(path).set(data).catch(handleFirebaseError);
    }

    function deleteFromFirebase(path) {
        return database.ref(path).remove().catch(handleFirebaseError);
    }

    // ==================== مراقبة حالة المصادقة ====================
    auth.onAuthStateChanged(user => {
        if (user) {
            appState.isLoggedIn = true;
            appState.currentUser = user;
            document.getElementById('admin-user-email').textContent = user.email;
        } else {
            appState.isLoggedIn = false;
            appState.currentUser = null;
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('navbar').classList.remove('hidden');
        }
    });

    // ==================== دالة تسجيل الدخول ====================
    async function handleLogin(event) {
        event.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        const errorDiv = document.getElementById('login-error');
        const loginBtn = document.getElementById('login-btn');

        loginBtn.disabled = true;
        loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i>جاري التحقق...';

        try {
            await auth.signInWithEmailAndPassword(email, password);
            hideLogin();
            showAdminDashboard();
            showToast('تم تسجيل الدخول بنجاح');
        } catch (error) {
            errorDiv.textContent = error.message === 'The password is invalid or the user does not have a password.' ? 'البريد الإلكتروني أو كلمة المرور غير صحيحة' : error.message;
            errorDiv.classList.remove('hidden');
        } finally {
            loginBtn.disabled = false;
            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt ml-2"></i>تسجيل الدخول';
        }
    }

    function showLogin() {
        document.getElementById('login-modal').classList.remove('hidden');
    }

    function hideLogin() {
        document.getElementById('login-modal').classList.add('hidden');
        document.getElementById('login-error').classList.add('hidden');
        document.getElementById('login-form').reset();
    }

    function handleLogout() {
        auth.signOut().then(() => {
            hideAdminDashboard();
            showToast('تم تسجيل الخروج بنجاح');
        }).catch(handleFirebaseError);
    }

    function showAdminDashboard() {
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('admin-dashboard').classList.remove('hidden');
        document.getElementById('navbar').classList.add('hidden');
        // تحميل البيانات الحالية في النماذج
        loadContentForm();
        loadServicesList();
        loadStatsForm();
        loadNewsList();
        loadVideosList(); // تحميل قائمة الفيديوهات
        loadTestimonialsList();
        loadDownloadsForm();
        loadSocialForm();
        loadAdminsList();
        updateDashboardCounts();
        // close sidebar on mobile after login
        if (window.innerWidth < 1024) {
            document.getElementById('admin-sidebar').classList.remove('open');
            document.getElementById('admin-overlay').classList.remove('open');
        }
    }

    function hideAdminDashboard() {
        document.getElementById('admin-dashboard').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('navbar').classList.remove('hidden');
    }

    function previewSite() {
        hideAdminDashboard();
        if (window.innerWidth < 1024) toggleAdminSidebar();
    }

    function showAdminSection(section) {
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.classList.remove('active');
            if (link.dataset.section === section) link.classList.add('active');
        });
        document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
        document.getElementById(`section-${section}`).classList.remove('hidden');
        const titles = {
            'dashboard': 'لوحة التحكم',
            'content': 'المحتوى العام',
            'services': 'إدارة الخدمات',
            'statistics': 'الإحصائيات',
            'news': 'آخر الأخبار',
            'videos': 'الفيديوهات التعليمية',
            'testimonials': 'آراء العملاء',
            'downloads': 'روابط التحميل',
            'social': 'وسائل التواصل',
            'admins': 'إدارة المسؤولين'
        };
        document.getElementById('admin-page-title').textContent = titles[section] || 'لوحة التحكم';
        appState.currentSection = section;
    }

    function toggleAdminSidebar() {
        const sidebar = document.getElementById('admin-sidebar');
        const overlay = document.getElementById('admin-overlay');
        sidebar.classList.toggle('open');
        overlay.classList.toggle('open');
    }

    // ==================== تحديث الواجهة العامة ====================
    function updatePublicContent() {
        document.getElementById('nav-title').textContent = appState.settings.siteTitle;
        document.getElementById('hero-title').innerHTML = appState.settings.heroTitle.replace('وأمان', '<span class="text-teal">وأمان</span>');
        document.getElementById('hero-subtitle').textContent = appState.settings.heroSubtitle;
        document.getElementById('footer-email').textContent = appState.settings.email;
        document.getElementById('footer-phone').textContent = appState.settings.phone;
        document.getElementById('footer-address').textContent = appState.settings.address;
        document.querySelectorAll('img[alt="واصل كاش"]').forEach(img => img.src = appState.settings.logo);
    }

    function updatePublicStats() {
        document.getElementById('stat-users').textContent = appState.stats.users;
        document.getElementById('stat-users-label').textContent = appState.stats.usersLabel;
        document.getElementById('stat-transfers').textContent = appState.stats.transfers;
        document.getElementById('stat-transfers-label').textContent = appState.stats.transfersLabel;
        document.getElementById('stat-payments').textContent = appState.stats.payments;
        document.getElementById('stat-payments-label').textContent = appState.stats.paymentsLabel;
        document.getElementById('stat-agents').textContent = appState.stats.agents;
        document.getElementById('stat-agents-label').textContent = appState.stats.agentsLabel;
    }

    function updatePublicServices() {
        const container = document.getElementById('services-grid');
        if (!container) return;
        if (!appState.services.length) {
            container.innerHTML = '<p class="text-center text-gray-500 col-span-full">لا توجد خدمات مضافة بعد.</p>';
            return;
        }
        container.innerHTML = appState.services.map(service => `
            <div class="bg-white rounded-2xl p-4 sm:p-8 shadow-lg card-hover">
                <div class="service-icon"><i class="${escapeHtml(service.icon)}"></i></div>
                <h3 class="text-base sm:text-xl font-bold text-primary mb-3 text-center">${escapeHtml(service.title)}</h3>
                <p class="text-gray-600 text-xs sm:text-base text-center">${escapeHtml(service.description)}</p>
            </div>
        `).join('');
    }

    function updatePublicTestimonials() {
        const container = document.getElementById('testimonials-grid');
        if (!container) return;
        if (!appState.testimonials.length) {
            container.innerHTML = '<p class="text-center text-gray-500 col-span-full">لا توجد آراء بعد.</p>';
            return;
        }
        const colors = ['from-teal to-primary', 'from-gold to-orange-500', 'from-green-400 to-emerald-600'];
        container.innerHTML = appState.testimonials.map((t, i) => `
            <div class="testimonial-card rounded-2xl p-4 sm:p-8 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br ${colors[i % colors.length]} flex items-center justify-center text-white text-lg sm:text-2xl font-bold">
                        ${escapeHtml(t.name.charAt(0))}
                    </div>
                    <div>
                        <h4 class="font-bold text-primary text-sm sm:text-base">${escapeHtml(t.name)}</h4>
                        <p class="text-gray-500 text-xs sm:text-sm">${escapeHtml(t.role)}</p>
                    </div>
                </div>
                <p class="text-gray-600 text-xs sm:text-sm leading-relaxed">"${escapeHtml(t.text)}"</p>
                <div class="flex gap-1 mt-4 text-gold">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                </div>
            </div>
        `).join('');
    }

    function updatePublicNews() {
        const container = document.getElementById('news-grid');
        if (!container) {
            console.error('عنصر news-grid غير موجود!');
            return;
        }
        if (!appState.news || appState.news.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 col-span-full">لا توجد أخبار بعد.</p>';
            document.getElementById('news-more-container').classList.add('hidden');
            return;
        }

        // عرض الأخبار حسب العداد الحالي (newsDisplayCount)
        const displayNews = appState.news.slice(0, appState.newsDisplayCount);
        container.innerHTML = displayNews.map(item => {
            const title = item.title || 'بدون عنوان';
            const content = item.content || '';
            const image = item.image || '';
            const date = item.date ? new Date(item.date).toLocaleDateString('ar-EG') : '';
            // قص النص إذا كان طويلاً
            const shortContent = content.length > 120 ? content.substring(0, 120) + '...' : content;
            return `
                <div class="news-card">
                    <div class="news-image" style="background-image: url('${escapeHtml(image)}')"></div>
                    <div class="p-4 sm:p-6">
                        <h3 class="text-lg sm:text-xl font-bold text-primary mb-2">${escapeHtml(title)}</h3>
                        <p class="text-gray-600 text-sm mb-4">${escapeHtml(shortContent)}</p>
                        ${date ? `<p class="text-gray-400 text-xs mb-2"><i class="fas fa-calendar-alt ml-1"></i>${date}</p>` : ''}
                        <a href="${escapeHtml(image)}" target="_blank" class="text-teal hover:underline text-sm">عرض الصورة كاملة</a>
                    </div>
                </div>
            `;
        }).join('');

        // إظهار أو إخفاء زر "عرض المزيد"
        const moreContainer = document.getElementById('news-more-container');
        if (appState.news.length > appState.newsDisplayCount) {
            moreContainer.classList.remove('hidden');
        } else {
            moreContainer.classList.add('hidden');
        }
    }

    // دالة تحميل المزيد من الأخبار
    function loadMoreNews() {
        appState.newsDisplayCount = appState.news.length; // عرض الكل
        updatePublicNews();
    }

    function updatePublicVideos() {
        const container = document.getElementById('videos-grid');
        if (!container) return;
        if (!appState.videos || appState.videos.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 col-span-full">لا توجد فيديوهات بعد.</p>';
            return;
        }

        container.innerHTML = appState.videos.map(video => {
            const title = video.title || 'فيديو تعليمي';
            // استخراج معرف اليوتيوب من الرابط
            let videoId = '';
            if (video.url) {
                const match = video.url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/);
                videoId = match ? match[1] : '';
            }
            const thumbnail = video.thumbnail || (videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : '');
            const embedUrl = videoId ? `https://www.youtube.com/embed/${videoId}` : '';

            return `
                <div class="video-card">
                    <div class="video-thumbnail" style="background-image: url('${escapeHtml(thumbnail)}')">
                        <a href="${embedUrl}" target="_blank" class="video-play-button">
                            <i class="fas fa-play"></i>
                        </a>
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-bold text-primary mb-2">${escapeHtml(title)}</h3>
                        <a href="${embedUrl}" target="_blank" class="text-teal hover:underline text-sm inline-flex items-center gap-1">
                            <i class="fas fa-play-circle"></i> مشاهدة الفيديو
                        </a>
                    </div>
                </div>
            `;
        }).join('');
    }

    function updatePublicDownloads() {
        const androidLink1 = document.getElementById('android-link');
        const androidLink2 = document.getElementById('android-link-2');
        const iosLink1 = document.getElementById('ios-link');
        const iosLink2 = document.getElementById('ios-link-2');

        const setLink = (element, url) => {
            if (!element) return;
            if (url && url.trim() !== '') {
                element.href = url;
                element.classList.remove('opacity-50', 'pointer-events-none');
            } else {
                // إذا لم يكن هناك رابط، نضيف رابط وهمي ونجعله غير قابل للنقر مع شفافية
                element.href = '#';
                element.classList.add('opacity-50', 'pointer-events-none');
            }
        };

        setLink(androidLink1, appState.settings.androidLink);
        setLink(androidLink2, appState.settings.androidLink);
        setLink(iosLink1, appState.settings.iosLink);
        setLink(iosLink2, appState.settings.iosLink);
    }

    function updatePublicSocial() {
        const container = document.getElementById('social-links');
        if (!container) return;
        const platforms = [
            { key: 'facebook', icon: 'fab fa-facebook-f', gradient: 'from-blue-600 to-blue-800' },
            { key: 'twitter', icon: 'fab fa-twitter', gradient: 'from-sky-400 to-sky-600' },
            { key: 'instagram', icon: 'fab fa-instagram', gradient: 'from-pink-500 to-purple-600' },
            { key: 'whatsapp', icon: 'fab fa-whatsapp', gradient: 'from-green-500 to-green-700' },
            { key: 'youtube', icon: 'fab fa-youtube', gradient: 'from-red-500 to-red-700' },
            { key: 'telegram', icon: 'fab fa-telegram-plane', gradient: 'from-blue-400 to-blue-600' }
        ];
        container.innerHTML = platforms.map(p => {
            const url = appState.settings.social[p.key] || '#';
            return `
                <a href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer" class="social-link w-10 h-10 sm:w-14 sm:h-14 rounded-full bg-gradient-to-br ${p.gradient} flex items-center justify-center text-white text-lg sm:text-2xl hover:scale-110 transition-transform ${url === '#' ? 'opacity-50 pointer-events-none' : ''}">
                    <i class="${p.icon}"></i>
                </a>
            `;
        }).join('');
    }

    // ==================== دوال تحميل النماذج في لوحة الإدارة ====================
    function loadContentForm() {
        document.getElementById('content-site-title').value = appState.settings.siteTitle;
        document.getElementById('content-logo').value = appState.settings.logo;
        document.getElementById('content-hero-title').value = appState.settings.heroTitle;
        document.getElementById('content-hero-subtitle').value = appState.settings.heroSubtitle;
        document.getElementById('content-email').value = appState.settings.email;
        document.getElementById('content-phone').value = appState.settings.phone;
        document.getElementById('content-address').value = appState.settings.address;
    }

    async function saveContent(event) {
        event.preventDefault();
        appState.settings.siteTitle = document.getElementById('content-site-title').value;
        appState.settings.logo = document.getElementById('content-logo').value;
        appState.settings.heroTitle = document.getElementById('content-hero-title').value;
        appState.settings.heroSubtitle = document.getElementById('content-hero-subtitle').value;
        appState.settings.email = document.getElementById('content-email').value;
        appState.settings.phone = document.getElementById('content-phone').value;
        appState.settings.address = document.getElementById('content-address').value;

        await saveToFirebase('settings', appState.settings);
        showToast('تم حفظ المحتوى بنجاح');
    }

    function loadServicesList() {
        const container = document.getElementById('admin-services-list');
        if (!container) return;
        if (!appState.services.length) {
            container.innerHTML = '<p class="text-gray-500 text-center py-8 text-sm">لا توجد خدمات بعد. أضف خدمة جديدة.</p>';
            return;
        }
        container.innerHTML = appState.services.map(service => `
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg gap-4" data-id="${escapeHtml(service.id)}">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                    <div class="service-icon" style="width: 48px; height: 48px; font-size: 18px;"><i class="${escapeHtml(service.icon)}"></i></div>
                    <div class="flex-1">
                        <h4 class="font-bold text-primary text-sm sm:text-base">${escapeHtml(service.title)}</h4>
                        <p class="text-gray-500 text-xs">${escapeHtml(service.description.substring(0, 50))}...</p>
                    </div>
                </div>
                <div class="flex gap-2 w-full sm:w-auto justify-end">
                    <button onclick="editService('${escapeHtml(service.id)}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg"><i class="fas fa-edit"></i></button>
                    <button onclick="deleteService('${escapeHtml(service.id)}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        `).join('');
    }

    function showAddServiceModal() {
        document.getElementById('service-modal-title').textContent = 'إضافة خدمة جديدة';
        document.getElementById('service-form').reset();
        document.getElementById('service-id').value = '';
        document.getElementById('service-modal').classList.remove('hidden');
    }

    function hideServiceModal() {
        document.getElementById('service-modal').classList.add('hidden');
    }

    function editService(id) {
        const service = appState.services.find(s => s.id === id);
        if (service) {
            document.getElementById('service-modal-title').textContent = 'تعديل الخدمة';
            document.getElementById('service-id').value = service.id;
            document.getElementById('service-title').value = service.title;
            document.getElementById('service-description').value = service.description;
            document.getElementById('service-icon').value = service.icon;
            document.getElementById('service-order').value = service.order;
            document.getElementById('service-modal').classList.remove('hidden');
        }
    }

    async function saveService(event) {
        event.preventDefault();
        const id = document.getElementById('service-id').value || Date.now().toString();
        const service = {
            id,
            title: document.getElementById('service-title').value,
            description: document.getElementById('service-description').value,
            icon: document.getElementById('service-icon').value,
            order: parseInt(document.getElementById('service-order').value)
        };

        const existingIndex = appState.services.findIndex(s => s.id === id);
        if (existingIndex >= 0) {
            appState.services[existingIndex] = service;
        } else {
            appState.services.push(service);
        }
        appState.services.sort((a, b) => a.order - b.order);
        const servicesObj = {};
        appState.services.forEach(s => servicesObj[s.id] = s);
        await saveToFirebase('services', servicesObj);
        hideServiceModal();
        showToast('تم حفظ الخدمة بنجاح');
    }

    function deleteService(id) {
        showDeleteModal('هل أنت متأكد من حذف هذه الخدمة؟', async () => {
            appState.services = appState.services.filter(s => s.id !== id);
            const servicesObj = {};
            appState.services.forEach(s => servicesObj[s.id] = s);
            await saveToFirebase('services', servicesObj);
            showToast('تم حذف الخدمة بنجاح');
        });
    }

    function loadStatsForm() {
        document.getElementById('stat-users-input').value = appState.stats.users;
        document.getElementById('stat-users-label').value = appState.stats.usersLabel;
        document.getElementById('stat-transfers-input').value = appState.stats.transfers;
        document.getElementById('stat-transfers-label').value = appState.stats.transfersLabel;
        document.getElementById('stat-payments-input').value = appState.stats.payments;
        document.getElementById('stat-payments-label').value = appState.stats.paymentsLabel;
        document.getElementById('stat-agents-input').value = appState.stats.agents;
        document.getElementById('stat-agents-label').value = appState.stats.agentsLabel;
    }

    async function saveStats(event) {
        event.preventDefault();
        appState.stats = {
            users: document.getElementById('stat-users-input').value,
            usersLabel: document.getElementById('stat-users-label').value,
            transfers: document.getElementById('stat-transfers-input').value,
            transfersLabel: document.getElementById('stat-transfers-label').value,
            payments: document.getElementById('stat-payments-input').value,
            paymentsLabel: document.getElementById('stat-payments-label').value,
            agents: document.getElementById('stat-agents-input').value,
            agentsLabel: document.getElementById('stat-agents-label').value
        };
        await saveToFirebase('stats', appState.stats);
        showToast('تم حفظ الإحصائيات بنجاح');
    }

    function loadNewsList() {
        const container = document.getElementById('admin-news-list');
        if (!container) return;
        if (!appState.news.length) {
            container.innerHTML = '<p class="text-gray-500 text-center py-8 text-sm">لا توجد أخبار بعد. أضف خبراً جديداً.</p>';
            return;
        }
        container.innerHTML = appState.news.map(item => {
            const date = item.date ? new Date(item.date).toLocaleDateString('ar-EG') : '';
            return `
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg gap-4" data-id="${escapeHtml(item.id)}">
                    <div class="flex items-center gap-4 w-full sm:w-auto">
                        <div class="w-12 h-12 rounded-lg bg-cover bg-center" style="background-image: url('${escapeHtml(item.image)}');"></div>
                        <div class="flex-1">
                            <h4 class="font-bold text-primary text-sm sm:text-base">${escapeHtml(item.title)}</h4>
                            <p class="text-gray-500 text-xs truncate max-w-[200px]">${escapeHtml(item.content.substring(0, 50))}...</p>
                            ${date ? `<p class="text-gray-400 text-xs">${date}</p>` : ''}
                        </div>
                    </div>
                    <div class="flex gap-2 w-full sm:w-auto justify-end">
                        <button onclick="editNews('${escapeHtml(item.id)}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteNews('${escapeHtml(item.id)}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function showAddNewsModal() {
        document.getElementById('news-modal-title').textContent = 'إضافة خبر جديد';
        document.getElementById('news-form').reset();
        document.getElementById('news-id').value = '';
        document.getElementById('news-modal').classList.remove('hidden');
    }

    function hideNewsModal() {
        document.getElementById('news-modal').classList.add('hidden');
    }

    function editNews(id) {
        const item = appState.news.find(n => n.id === id);
        if (item) {
            document.getElementById('news-modal-title').textContent = 'تعديل الخبر';
            document.getElementById('news-id').value = item.id;
            document.getElementById('news-title').value = item.title;
            document.getElementById('news-content').value = item.content;
            document.getElementById('news-image').value = item.image;
            document.getElementById('news-date').value = item.date || '';
            document.getElementById('news-modal').classList.remove('hidden');
        }
    }

    async function saveNews(event) {
        event.preventDefault();
        const id = document.getElementById('news-id').value || Date.now().toString();
        const newsItem = {
            id,
            title: document.getElementById('news-title').value,
            content: document.getElementById('news-content').value,
            image: document.getElementById('news-image').value,
            date: document.getElementById('news-date').value
        };

        const existingIndex = appState.news.findIndex(n => n.id === id);
        if (existingIndex >= 0) {
            appState.news[existingIndex] = newsItem;
        } else {
            appState.news.push(newsItem);
        }
        appState.news.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
        const newsObj = {};
        appState.news.forEach(n => newsObj[n.id] = n);
        await saveToFirebase('news', newsObj);
        hideNewsModal();
        showToast('تم حفظ الخبر بنجاح');
    }

    function deleteNews(id) {
        showDeleteModal('هل أنت متأكد من حذف هذا الخبر؟', async () => {
            appState.news = appState.news.filter(n => n.id !== id);
            const newsObj = {};
            appState.news.forEach(n => newsObj[n.id] = n);
            await saveToFirebase('news', newsObj);
            showToast('تم حذف الخبر بنجاح');
        });
    }

    // دوال إدارة الفيديوهات
    function loadVideosList() {
        const container = document.getElementById('admin-videos-list');
        if (!container) return;
        if (!appState.videos.length) {
            container.innerHTML = '<p class="text-gray-500 text-center py-8 text-sm">لا توجد فيديوهات بعد. أضف فيديو جديد.</p>';
            return;
        }
        container.innerHTML = appState.videos.map(video => `
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg gap-4" data-id="${escapeHtml(video.id)}">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                    <div class="w-12 h-12 rounded-lg bg-cover bg-center" style="background-image: url('${escapeHtml(video.thumbnail || `https://img.youtube.com/vi/${getYouTubeId(video.url)}/default.jpg`)}');"></div>
                    <div class="flex-1">
                        <h4 class="font-bold text-primary text-sm sm:text-base">${escapeHtml(video.title)}</h4>
                        <p class="text-gray-500 text-xs">ترتيب: ${video.order || 1}</p>
                    </div>
                </div>
                <div class="flex gap-2 w-full sm:w-auto justify-end">
                    <button onclick="editVideo('${escapeHtml(video.id)}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg"><i class="fas fa-edit"></i></button>
                    <button onclick="deleteVideo('${escapeHtml(video.id)}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        `).join('');
    }

    function getYouTubeId(url) {
        if (!url) return '';
        const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/);
        return match ? match[1] : '';
    }

    function showAddVideoModal() {
        document.getElementById('video-modal-title').textContent = 'إضافة فيديو جديد';
        document.getElementById('video-form').reset();
        document.getElementById('video-id').value = '';
        document.getElementById('video-modal').classList.remove('hidden');
    }

    function hideVideoModal() {
        document.getElementById('video-modal').classList.add('hidden');
    }

    function editVideo(id) {
        const video = appState.videos.find(v => v.id === id);
        if (video) {
            document.getElementById('video-modal-title').textContent = 'تعديل الفيديو';
            document.getElementById('video-id').value = video.id;
            document.getElementById('video-title').value = video.title;
            document.getElementById('video-url').value = video.url;
            document.getElementById('video-thumbnail').value = video.thumbnail || '';
            document.getElementById('video-order').value = video.order || 1;
            document.getElementById('video-modal').classList.remove('hidden');
        }
    }

    async function saveVideo(event) {
        event.preventDefault();
        const id = document.getElementById('video-id').value || Date.now().toString();
        const video = {
            id,
            title: document.getElementById('video-title').value,
            url: document.getElementById('video-url').value,
            thumbnail: document.getElementById('video-thumbnail').value,
            order: parseInt(document.getElementById('video-order').value) || 1
        };

        const existingIndex = appState.videos.findIndex(v => v.id === id);
        if (existingIndex >= 0) {
            appState.videos[existingIndex] = video;
        } else {
            appState.videos.push(video);
        }
        appState.videos.sort((a, b) => (a.order || 999) - (b.order || 999));
        const videosObj = {};
        appState.videos.forEach(v => videosObj[v.id] = v);
        await saveToFirebase('videos', videosObj);
        hideVideoModal();
        showToast('تم حفظ الفيديو بنجاح');
    }

    function deleteVideo(id) {
        showDeleteModal('هل أنت متأكد من حذف هذا الفيديو؟', async () => {
            appState.videos = appState.videos.filter(v => v.id !== id);
            const videosObj = {};
            appState.videos.forEach(v => videosObj[v.id] = v);
            await saveToFirebase('videos', videosObj);
            showToast('تم حذف الفيديو بنجاح');
        });
    }

    function loadTestimonialsList() {
        const container = document.getElementById('admin-testimonials-list');
        if (!container) return;
        if (!appState.testimonials.length) {
            container.innerHTML = '<p class="text-gray-500 text-center py-8 text-sm">لا توجد آراء بعد. أضف رأياً جديداً.</p>';
            return;
        }
        container.innerHTML = appState.testimonials.map(t => `
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg gap-4" data-id="${escapeHtml(t.id)}">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-teal to-primary flex items-center justify-center text-white font-bold text-base sm:text-lg">${escapeHtml(t.name.charAt(0))}</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-primary text-sm sm:text-base">${escapeHtml(t.name)}</h4>
                        <p class="text-gray-500 text-xs">${escapeHtml(t.role)}</p>
                    </div>
                </div>
                <div class="flex gap-2 w-full sm:w-auto justify-end">
                    <button onclick="editTestimonial('${escapeHtml(t.id)}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg"><i class="fas fa-edit"></i></button>
                    <button onclick="deleteTestimonial('${escapeHtml(t.id)}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        `).join('');
    }

    function showAddTestimonialModal() {
        document.getElementById('testimonial-modal-title').textContent = 'إضافة رأي جديد';
        document.getElementById('testimonial-form').reset();
        document.getElementById('testimonial-id').value = '';
        document.getElementById('testimonial-modal').classList.remove('hidden');
    }

    function hideTestimonialModal() {
        document.getElementById('testimonial-modal').classList.add('hidden');
    }

    function editTestimonial(id) {
        const t = appState.testimonials.find(item => item.id === id);
        if (t) {
            document.getElementById('testimonial-modal-title').textContent = 'تعديل الرأي';
            document.getElementById('testimonial-id').value = t.id;
            document.getElementById('testimonial-name').value = t.name;
            document.getElementById('testimonial-role').value = t.role;
            document.getElementById('testimonial-text').value = t.text;
            document.getElementById('testimonial-image').value = t.image || '';
            document.getElementById('testimonial-modal').classList.remove('hidden');
        }
    }

    async function saveTestimonial(event) {
        event.preventDefault();
        const id = document.getElementById('testimonial-id').value || Date.now().toString();
        const testimonial = {
            id,
            name: document.getElementById('testimonial-name').value,
            role: document.getElementById('testimonial-role').value,
            text: document.getElementById('testimonial-text').value,
            image: document.getElementById('testimonial-image').value
        };

        const existingIndex = appState.testimonials.findIndex(t => t.id === id);
        if (existingIndex >= 0) {
            appState.testimonials[existingIndex] = testimonial;
        } else {
            appState.testimonials.push(testimonial);
        }
        const testimonialsObj = {};
        appState.testimonials.forEach(t => testimonialsObj[t.id] = t);
        await saveToFirebase('testimonials', testimonialsObj);
        hideTestimonialModal();
        showToast('تم حفظ الرأي بنجاح');
    }

    function deleteTestimonial(id) {
        showDeleteModal('هل أنت متأكد من حذف هذا الرأي؟', async () => {
            appState.testimonials = appState.testimonials.filter(t => t.id !== id);
            const testimonialsObj = {};
            appState.testimonials.forEach(t => testimonialsObj[t.id] = t);
            await saveToFirebase('testimonials', testimonialsObj);
            showToast('تم حذف الرأي بنجاح');
        });
    }

    function loadDownloadsForm() {
        document.getElementById('download-android').value = appState.settings.androidLink;
        document.getElementById('download-ios').value = appState.settings.iosLink;
    }

    async function saveDownloads(event) {
        event.preventDefault();
        appState.settings.androidLink = document.getElementById('download-android').value;
        appState.settings.iosLink = document.getElementById('download-ios').value;
        await saveToFirebase('downloads', { android: appState.settings.androidLink, ios: appState.settings.iosLink });
        showToast('تم حفظ روابط التحميل بنجاح');
    }

    function loadSocialForm() {
        document.getElementById('social-facebook').value = appState.settings.social.facebook;
        document.getElementById('social-twitter').value = appState.settings.social.twitter;
        document.getElementById('social-instagram').value = appState.settings.social.instagram;
        document.getElementById('social-whatsapp').value = appState.settings.social.whatsapp;
        document.getElementById('social-youtube').value = appState.settings.social.youtube;
        document.getElementById('social-telegram').value = appState.settings.social.telegram;
    }

    async function saveSocial(event) {
        event.preventDefault();
        appState.settings.social = {
            facebook: document.getElementById('social-facebook').value,
            twitter: document.getElementById('social-twitter').value,
            instagram: document.getElementById('social-instagram').value,
            whatsapp: document.getElementById('social-whatsapp').value,
            youtube: document.getElementById('social-youtube').value,
            telegram: document.getElementById('social-telegram').value
        };
        await saveToFirebase('social', appState.settings.social);
        showToast('تم حفظ روابط التواصل بنجاح');
    }

    function loadAdminsList() {
        const container = document.getElementById('admin-admins-list');
        if (!container) return;
        if (!appState.admins.length) {
            container.innerHTML = '<p class="text-gray-500 text-center py-4 text-sm">لا يوجد مسؤولين إضافيين</p>';
            return;
        }
        container.innerHTML = appState.admins.map(a => `
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg gap-4" data-id="${escapeHtml(a.id)}">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-gray-400 to-gray-600 flex items-center justify-center text-white"><i class="fas fa-user text-sm sm:text-base"></i></div>
                    <div class="flex-1">
                        <h4 class="font-bold text-primary text-sm sm:text-base">${escapeHtml(a.email)}</h4>
                        <p class="text-gray-500 text-xs">مسؤول</p>
                    </div>
                </div>
                <button onclick="deleteAdmin('${escapeHtml(a.id)}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg w-full sm:w-auto"><i class="fas fa-trash"></i></button>
            </div>
        `).join('');
    }

    function showAddAdminModal() {
        document.getElementById('admin-form').reset();
        document.getElementById('admin-modal').classList.remove('hidden');
    }

    function hideAdminModal() {
        document.getElementById('admin-modal').classList.add('hidden');
    }

    async function saveAdmin(event) {
        event.preventDefault();
        const email = document.getElementById('admin-email-input').value;
        const password = document.getElementById('admin-password-input').value;

        try {
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const uid = userCredential.user.uid;
            const adminRecord = {
                id: uid,
                email: email,
            };
            appState.admins.push(adminRecord);
            const adminsObj = {};
            appState.admins.forEach(a => adminsObj[a.id] = { id: a.id, email: a.email });
            await saveToFirebase('admins', adminsObj);
            hideAdminModal();
            showToast('تم إضافة المسؤول بنجاح');
        } catch (error) {
            handleFirebaseError(error);
        }
    }

    function deleteAdmin(id) {
        showDeleteModal('هل أنت متأكد من حذف هذا المسؤول؟', async () => {
            appState.admins = appState.admins.filter(a => a.id !== id);
            const adminsObj = {};
            appState.admins.forEach(a => adminsObj[a.id] = { id: a.id, email: a.email });
            await saveToFirebase('admins', adminsObj);
            showToast('تم حذف المسؤول من القاعدة. يرجى حذفه يدوياً من Firebase Authentication إذا لزم الأمر.', 'error');
        });
    }

    function updateDashboardCounts() {
        document.getElementById('admin-services-count').textContent = appState.services.length;
        document.getElementById('admin-testimonials-count').textContent = appState.testimonials.length;
        document.getElementById('admin-news-count').textContent = appState.news.length;
        document.getElementById('admin-videos-count').textContent = appState.videos.length;
        document.getElementById('admin-admins-count').textContent = appState.admins.length;
    }

    // ==================== حذف التأكيد ====================
    function showDeleteModal(message, callback) {
        document.getElementById('delete-message').textContent = message;
        appState.deleteCallback = callback;
        document.getElementById('delete-modal').classList.remove('hidden');
    }

    function hideDeleteModal() {
        document.getElementById('delete-modal').classList.add('hidden');
        appState.deleteCallback = null;
    }

    function confirmDelete() {
        if (appState.deleteCallback) {
            appState.deleteCallback();
        }
        hideDeleteModal();
    }

    // ==================== دوال أخرى ====================
    function toggleMobileMenu() {
        document.getElementById('mobile-menu').classList.toggle('hidden');
    }

    window.addEventListener('scroll', () => {
        const navbar = document.getElementById('navbar');
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
    });

    // ==================== بدء التطبيق ====================
    function init() {
        setupFirebaseListeners();
        incrementVisitorCount(); // زيادة عداد الزوار عند تحميل الصفحة
        // Close admin sidebar on window resize if open and screen becomes large
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                document.getElementById('admin-sidebar').classList.remove('open');
                document.getElementById('admin-overlay').classList.remove('open');
            }
        });
    }

    init();
  </script>
 </body>
  </html> 
